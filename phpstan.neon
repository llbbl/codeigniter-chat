# PHPStan Configuration for CodeIgniter 4 Chat Application
#
# This is a static analysis tool that helps catch bugs before they happen.
# Level 5 is a good starting point - strict enough to catch real issues,
# but not so strict that it overwhelms with false positives.
#
# Run with: composer analyse
#
# For more info: https://phpstan.org/user-guide/getting-started

parameters:
    # Analysis level (0-9, where 9 is strictest)
    # Level 5 provides good coverage for a learning project:
    # - Checks unknown classes, methods, properties
    # - Checks return types and parameter types
    # - Checks that methods return the correct types
    level: 5

    # Paths to analyse
    paths:
        - app/

    # Paths to exclude from analysis
    excludePaths:
        # Views contain mixed PHP/HTML and often trigger false positives
        - app/Views/*
        # Config files have their own patterns
        - app/Config/*
        # Language files are just arrays
        - app/Language/*
        # Filters have interface compatibility issues with typed parameters
        # TODO: Fix filter method signatures to match FilterInterface
        - app/Filters/*
        # Commands have strict typing conflicts with BaseCommand
        # TODO: Fix command property type declarations
        - app/Commands/*

    # Bootstrap files for autoloading
    # These help PHPStan understand CodeIgniter's structure
    bootstrapFiles:
        - vendor/codeigniter4/framework/system/Test/bootstrap.php

    # Scan files that are included but not directly analysed
    scanFiles:
        - app/Common.php

    # Ignore these specific errors that are common in CodeIgniter
    # These are framework patterns that would require significant refactoring
    ignoreErrors:
        # CodeIgniter's helper functions are loaded dynamically
        - '#Function [a-z_]+ not found#'

        # session() helper returns various types
        - '#Cannot call method get\(\) on mixed#'

        # Common CodeIgniter patterns with dynamic returns
        - '#Method .+ should return .+ but returns mixed#'

        # CodeIgniter Model uses magic __call for query builder methods
        # Methods like get(), where(), orderBy() are proxied to the query builder
        - '#Call to an undefined method App\\Models\\.+::(get|where|orderBy|limit|select|join|groupBy|having)\(\)#'

        # CodeIgniter Cache interface vs actual cache implementation
        # deleteMatching() exists on file/redis cache but not in interface
        - '#Call to an undefined method CodeIgniter\\Cache\\CacheInterface::deleteMatching\(\)#'

        # PHPDoc vs native return type mismatches in controllers
        # CodeIgniter controllers often have flexible return types
        - '#PHPDoc tag @return with type .+ is not subtype of native type#'

        # Security class method variations between CI versions
        - '#Call to an undefined method CodeIgniter\\Security\\Security::#'

        # Strict comparison warnings for environment checks
        # These are intentional - checking specific environments
        - '#Strict comparison using === between .+ will always evaluate to false#'
        - '#Result of && is always false#'
        - '#Right side of && is always false#'

        # Controller return type mismatches
        # CodeIgniter controllers can return string, Response, or RedirectResponse
        - '#Method App\\Controllers\\.+::.+ should return .+ but returns (string|CodeIgniter\\HTTP\\ResponseInterface|CodeIgniter\\HTTP\\RedirectResponse)#'

        # ResponseHelper return type - interface vs concrete class
        - '#Method App\\Helpers\\ResponseHelper::.+ should return CodeIgniter\\HTTP\\Response but returns CodeIgniter\\HTTP\\ResponseInterface#'

        # isset() on initialized variables
        - '#Variable .+ in isset\(\) always exists and is not nullable#'

    # Report unmatched ignored errors (helps clean up over time)
    reportUnmatchedIgnoredErrors: false

    # Treat PHPDoc types as uncertain to reduce false positives
    treatPhpDocTypesAsCertain: false

# Include CodeIgniter-specific extension if available
# (You can install phpstan/extension-installer for auto-loading)
includes: []
